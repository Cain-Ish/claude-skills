{
  "rule_id": "hook-stop-calls-cleanup",
  "version": "1.0.0",
  "category": "hook-correctness",
  "severity": "warning",
  "confidence": 0.9,
  "applies_to": {
    "component": "hooks",
    "pattern": "Stop\\.md$"
  },
  "validation": {
    "type": "static",
    "checks": [
      {
        "check_id": "calls-cleanup-command",
        "type": "regex",
        "pattern": "(/cleanup|process-janitor.*cleanup)",
        "error_message": "Stop hooks should call /cleanup to remove orphaned processes when session ends"
      }
    ]
  },
  "fix_template": {
    "type": "prepend-to-bash",
    "content": "# Clean up orphaned processes\necho \"Cleaning up orphaned processes...\"\nif command -v claude >/dev/null 2>&1; then\n  claude /cleanup 2>/dev/null || true\nfi\n\n"
  },
  "references": [
    "https://github.com/Cain-Ish/claude-skills/issues/cleanup-on-stop"
  ],
  "learned_from": "user_feedback",
  "discovered_at": "2026-01-25",
  "last_updated": "2026-01-25"
}
